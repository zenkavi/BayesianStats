# Stan on a cluster pipeline notes

## Steps you might need:

- Data prepation R script
- Model text file
- Model compilation and running R script
- Model output processing script
- Batch script parallelizing the model fit step

## Speeding up model fitting

1. `reduce_sum` (within chain parallelization)

From https://mc-stan.org/users/documentation/case-studies/reduce_sum_tutorial.html
"If a model has a large number of arguments that are either defined in the parameters block, transformed parameters block, or model block, or do not do very much computation inside the reduce function, or does not get lucky with caching, the speedup will be much more limited."

2. Parallelization of chains

This is done in Stan by default but on cores of a single node. Can it be parallelized across nodes and would this lead to any performance improvements?

## Progress and Todo's

What have I gotten done on TACC so far?

- ran the same simple model (using cmdstanr) with and without reduce_sum (sped up about twice)

What else needs to be done?

-nmm_ode needs to run as it is
  - interactive and batch script
-nmm_ode faster. try:
  - reduce_sum
  - parallelization
  - ADVI
-nmm_ode with more data
-parallelized cross validation